+++
author = "zenk"
date = "2017-06-15T19:13:25+08:00"
slug = ""
tags = ["go","编程","技术"]
title = "map 内部实现"

+++

# map 内部实现

```
   ^   +-----------------+  ^
   |   |       bucket0   |  |------> +------------+
   |   +-----------------+  v        | tophash 0  |
   |   |       bucket1   |           +------------+
   |   +-----------------+           | tophash 1  |
2^h.B  |      .......    |           +------------+
   |   +-----------------+           | .........  |
   |   | bucket2^h.B - 2 |           +------------+
   |   +-----------------+           | tophash 6  |
   |   | bucket2^h.B - 1 |           +------------+
   v   +-----------------+           | tophash 7  |
                                     +------------+
                                     |   key 0    |
                                     +------------+
                                     |   key 1    |
                                     +------------+
                                     |   .....    |
                                     +------------+
                                     |   key 6    |
                                     +------------+
                                     |   key 7    |
                                     +------------+
                                     |  value 0   |
                                     +------------+
                                     |  value 1   |
                                     +------------+
                                     |  .......   |
                                     +------------+
                                     |  value 6   |
                                     +------------+
                                     |  value 7   |
                                     +------------+ ^
                                     |overflow_ptr| |-----> +---------------------+-------------+----------------+--------------+
                                     +------------+ v       | tophash0 - tophash7 | key0 - key7 | value0 - value7| overflow_ptr |
                                                            +---------------------+-------------+----------------+--------------+
```



